version: 1
applications:
  - appRoot: web/frontend
    backend:
      phases:
        preBuild:
          commands:
            - nvm install 20.10.0
            - nvm use 20.10.0
            - node --version
            - npm --version
            - cd ../../
            - npm install --legacy-peer-deps
        build:
          commands:
            - echo "Backend build completed"
    frontend:
      phases:
        preBuild:
          commands:
            - nvm use 20.10.0
            - cd ../../
            - npm install --legacy-peer-deps
            - cd web
            - npm install --legacy-peer-deps
        build:
          commands:
            - npm run build --prefix frontend
      artifacts:
        baseDirectory: dist
        files:
          - '**/*'
      cache:
        paths:
          - ../../node_modules/**/*
          - ../node_modules/**/*